extends ui_layout
block content
  -var cdn = "https://dhpd030vnpk29.cloudfront.net";
  -var path = isResearchVersion ? 'intro' : 'guest';

  .ui.grid
    .row#blue-upper
      .ui.container
        if user.profile.name != "Guest"
          h1.ui.header.center.aligned Welcome back #{user.profile.name} !
        else 
          h1.ui.header.center.aligned Welcome!
        .limit(style="padding-bottom: 40px; text-align: center;")
          p#about What would you like to learn today?
          button.ui.inverted.button(style="margin-right: 20px;")
            | Courses in Progress
          button.ui.inverted.button
            | New Courses


    .row#white-lower

      //- Alert Hub
      .ui.container
        .limit.hub-container
          h2.ui.header#in-progress DART Alert Hub:
          a.ui(href=`#alert` alt="Begin identity theft module")
            .ui.raised.segment
              div#raised-content
                div.ui.header.hub-alert
                  i.exclamation.circle.icon
                  | Rise in Fake Gift Cards

                p.alert-info Gift cards are a fraudster’s favorite payment method. Since 2018, consumers have lost nearly $245 million to gift card scams
                button.ui.huge.button.right.floated.alert-learn-more 
                  span Learn More →
                  //- i.arrow.right.icon

        //- Courses
        .limit
          h2.ui.header#in-progress Courses:
          a.ui#theft-link(href=`/intro/identity` alt="Begin identity theft module")
            .ui.raised.segment
              .ui.fluid.container(style="height: 200px;")
                .ui.image.banner
                  img(src="/images/identity-theft-banner.jpg", alt="Identity Theft Banner Image")

                  #theft-progress.ui.bottom.attatched.small.progress(style='margin:0;padding:0;' data-percent='33')
                    .bar(style='border-radius: 0 !important;')
                      .progress
              #raised-content(style="padding-top: 20px;")
                h3.ui.header.large.home-mod-title
                  | Identity Theft
                p(style="color:black") Understand the consequences of identity theft and learn how to identify and take action against phishing scams on social media.
                button.ui.huge.blue.button.right.floated#nextButton
                  | Learn Now
                  i.arrow.right.icon
        .ui.basic.segment(style="text-align: center; margin-top: -15px;")
          button.ui.center.aligned.huge.basic.button#reset-progress(onclick="localStorage.setItem('progress', 0); localStorage.setItem('theft-path', 'intro/identity'); location.reload();") Reset Identity Theft Progress

block styles
  link(rel='stylesheet', href='/css/mods.css')

block scripts
  script. 
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

    //- const userId = 'jct324@lehigh.edu'; // Replace with the actual user ID
    const moduleId = 'identity'; // Replace with the actual module ID

    fetch(`/moduleprogress/${moduleId}`, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': csrfToken
      }
    })
    .then(response => {
      if (response.ok) {
        // Request was successful
        return response.json();
      } else {
        // Handle error response
        throw new Error('Failed to retrieve module progress');
      }
    })
    .then(data => {
      // Handle the retrieved module progress data
      const moduleProgressData = data;

      // Access the module progress data
      const progress = moduleProgressData.percent;
      const link = moduleProgressData.link;

      // update the indentity theft link
      const identity_link = document.getElementById('theft-link');
      identity_link.setAttribute('href', link);

      // update the indentity theft progress bar
      const progressBar = document.getElementById('theft-progress');
      if (progressBar) {
        progressBar.setAttribute('data-percent', progress);
        progressBar.querySelector('.bar').style.width = progress + "%";
        if(progress > 0 && progress < 100){
          progressBar.querySelector('.bar').style.backgroundColor = '#6BBCC7';
        } else if(progress == 100) {
          progressBar.querySelector('.bar').style.backgroundColor = 'blue';
        }
        progressBar.querySelector('.progress').textContent = progress + "%";
      } else {
        console.error('Could not find progress bar element');
      }



      console.log(`Module progress for ${moduleId}:`);
      console.log(`Percent: ${progress}`);
      console.log(`Link: ${link}`);
    })
    .catch(error => {
      // Handle network or fetch error
      console.error(error);
    });

            