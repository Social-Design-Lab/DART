extends ../../../module_layout

block content

  .ui.container#raised-container
    .limit
      .ui.raised.segment.chat-container(style="background-color: #F1EDED;")
        .ui.large.header
          .container#cropped-circular-image
            .ui.segment(style="background-color: #7D7C7C !important;")
              .ui.circular.small.image
                img.dart_image(src=user.avatarImg, alt='Agents text message profile picture')
              span(style="font-size: 2.5rem; margin-left: 20px;color:white;")  Chat with {user.avatar}
          br
          .content.text-message
            .ui.circular.tiny.image 
              img.dart_image(src=user.avatarImg, alt='Agents text message profile picture')
            .ui.large.left.pointing.label(style='width: 70%; margin-left: 10px;')
              p Excellent work, #{user.name}! You've finished the first section! May I ask you a question? Have you ever encountered a scam before?
          .content.text-message(style="margin-top: 25px;")
            .ui.circular.tiny.image 
              img.dart_image(src=user.avatarImg, alt='Agents text message profile picture')
            .ui.large.left.pointing.label(style='width: 70%; margin-left: 10px;')
              p It's perfectly fine if you prefer not to answer. Please click 'Complete Section 1' to continue learning.
          #encounter_container
            div#encounter_label
              .ui.large.right.pointing.label
                p#encounter_text 
              .ui.circular.tiny.image(style="background: white !important")
                img(src='/profile_pictures/avatar-icon.svg', alt='user text message profile picture')

            #encounter_response(style='clear: both;')
              button.ui.big.button.chatBotButton(onclick="showTopic('Yes')") Yes
              button.ui.big.button.chatBotButton(onclick="showTopic('No')") No
              button.ui.big.button.chatBotButton(onclick="showTopic('I\\'m not sure')") I'm not sure


          //- bot yes reply
          #yes_reply.content.text-message(style="display: none")
            .ui.circular.tiny.image 
              img.dart_image(src=user.avatarImg, alt='Agents text message profile picture')
            .ui.large.left.pointing.label(style='width: 70%; margin-left: 10px;')
              p Thank you for your response. If you don't mind me asking, could you please share more about your experience with the scam? Did you undergo any financial loss or other types of loss due to the scam? 
              p Please type your response below and hit the "send" button.

          //- bot no reply
          #no_reply.content.text-message(style="display: none")
            .ui.circular.tiny.image 
              img.dart_image(src=user.avatarImg, alt='Agents text message profile picture')
            .ui.large.left.pointing.label(style='width: 70%; margin-left: 10px;')
              p Thank you for your response. It's great to hear that you've never encountered scams! Please click the "Complete Section 1" button on the bottom right of the page to continue learning. 
            br
            br

          //- bot not sure reply
          #sure_reply.content.text-message(style="display: none")
            .ui.circular.tiny.image 
              img.dart_image(src=user.avatarImg, alt='Agents text message profile picture')
            .ui.large.left.pointing.label(style='width: 70%; margin-left: 10px;')
              p Thank you for your response. If you don't mind me asking, could you please share a little about what the suspicious interaction looked like? What did you encounter? 
              p Please type your response below and hit the "send" button.
          

          //- final response from the user
          #final_container(style="clear: both; float: right; margin-top: 40px;")
            div#final_label
              .ui.large.right.pointing.label
                p#sent_message 
                  span
                    i.ellipsis.horizontal.icon
              .ui.circular.tiny.image(style="background: white !important")
                img(src='/profile_pictures/avatar-icon.svg', alt='user text message profile picture')
            br
            br
            br




          //- suspicion question reply (the one after not sure)
          #sus_reply.content.text-message(style="display: none")
            .ui.circular.tiny.image 
              img.dart_image(src=user.avatarImg, alt='Agents text message profile picture')
            .ui.large.left.pointing.label(style='width: 70%; margin-left: 10px;')
              p That sounds like a scam! I'm glad you were able to recognize it and avoid it. 
              p It was great talking with you! Please click the "Complete Section 1" button on the bottom right of the page to continue learning. 
            br
            br

          //- experience question reply (the one after yes)
          #experience_reply.content.text-message(style="display: none")
            .ui.circular.tiny.image 
              img.dart_image(src=user.avatarImg, alt='Agents text message profile picture')
            .ui.large.left.pointing.label(style='width: 70%; margin-left: 10px;')
              p I'm sorry to hear that you had to go through that. I hope you were able to recover from the scam.
              p It was great talking with you! Please click the "Complete Section 1" button on the bottom right of the page to continue learning. 
            br
            br
      //- .ui.fluid.action.input
      //-   input(type='text' placeholder='Search...')
      //-   .ui.button Send 
      .ui.fluid.action.icon.input(style="margin-top: -15px;")
        input.message-input(type="text" placeholder="Type your message..." id="message-input")
        i.paper.plane.big.icon(style="color: #6BBCC7; margin-right: 60px;z-index:100;")
        .ui.button#send-button Send 
    br
    //- .ui.container#nav-container
    //-   div#nav-menu          
    //-     button.ui.huge.basic.button.left.floated#backButton(onclick="location.href='/submod/learn6/identity';") 
    //-       i.arrow.left.icon 
    //-       | Back
    //-     button.ui.huge.blue.button.right.floated#nextButton(onclick="location.href='/submod/learn8/identity';")
    //-       | Complete Section 1
    //-       i.arrow.right.icon
    script.
        var progress = #{user.moduleProgress.identity.percent}
    script(src='/js/setProgressBar.js')  


block append footer
  .ui.container
    +navButtons('identity', 'sub_learn7', '/learn/submod/6/identity', '/learn/submod/8/identity', 24, 'Back', 'Complete Section 1')  


block scripts
  script.
    postStartTime("identity", "sub_learn7");
    let accept_sending = false;
    let final_response_number = 0;

    $(document).ready(function() {
      $('#send-button').click(function() {
        if(accept_sending) {
          var userResponse = $('input#message-input').val();
          //- console.log(userResponse);

          var messageText = document.getElementById("sent_message");
          messageText.innerHTML = userResponse;

          // show final response to the users message
          if (final_response_number == 1) {
            document.getElementById("experience_reply").style.display = "";

          } else if (final_response_number == 2) {
            document.getElementById("sus_reply").style.display = "";
          }
        
        // Scroll the chat container to the bottom
        $('.chat-container').scrollTop($('.chat-container')[0].scrollHeight);

          $('input#message-input').val('');        
        }

        // disable sending messages after the user has sent a message
        accept_sending = false;
      });
    });


    // event listener to the input field submitting via enter key
    document.getElementById('message-input').addEventListener('keypress', function(event) {
      // Check if the enter key is pressed (key code 13)
      if (event.keyCode === 13 && accept_sending) {
        // Get the input value
        var inputValue = this.value;
        
        // set message text from the three elipses to the input value
        //- console.log(inputValue);
        var messageText = document.getElementById("sent_message");
        messageText.innerHTML = inputValue;

        // show final response to the users message
        if (final_response_number == 1) {
          document.getElementById("experience_reply").style.display = "";
        } else if (final_response_number == 2) {
          document.getElementById("sus_reply").style.display = "";
        }

        // Scroll the chat container to the bottom
        $('.chat-container').scrollTop($('.chat-container')[0].scrollHeight);

        // Clear the input field
        this.value = '';

        
        // disable sending messages after the user has sent a message
        accept_sending = false;
      }
    });

    function showTopic(name){
      var showMe = document.getElementById("encounter_text");
      showMe.innerHTML = name;
      document.getElementById("encounter_label").style.display = "flex";
      
      var hideMe = document.getElementById("encounter_response");
      hideMe.style.visibility = "hidden";
      //- console.log("Name: " + name)

      if (name == "No") {
        document.getElementById("no_reply").style.display = "";
      }

      if (name == "Yes") {
        document.getElementById("yes_reply").style.display = "";
        document.getElementById("final_label").style.display = "flex";
        accept_sending = true;
        final_response_number = 1;
      }

      if (name == "I'm not sure") {
        document.getElementById("sure_reply").style.display = "";
        document.getElementById("final_label").style.display = "flex";
        accept_sending = true;
        final_response_number = 2;
      }

      // Scroll the chat container to the bottom
      $('.chat-container').scrollTop($('.chat-container')[0].scrollHeight);
    }




    var voiceoverMappings = {
      '.showLearnSectionButton': {
        "initialDelay": 700,
        "delay": 500,
        "files": ['CUSML.6.1.1.mp3', 'CUSML.6.1.2.mp3']
      },
      '.voiceover_keyTerm1': {
        "initialDelay": 700,
        "delay": 0,
        "files": ['CUSML.6.2.1.mp3']
      },
      '.voiceover_keyTerm2': {
        "initialDelay": 700,
        "delay": 0,
        "files": ['CUSML.6.2.2.mp3']
      },
      '.voiceover_keyTerm3': {
        "initialDelay": 700,
        "delay": 0,
        "files": ['CUSML.6.2.3.mp3']
      }
    };

  script(src='/module_js/voiceover.js')
  script(src="/module_js/base_start.js")
  
block styles
  link(rel='stylesheet', href='/css/module.css')  
    
    